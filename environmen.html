<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Environment</title>
  <style>
    :root{
      --leaf-1: #7fb3ff;
      --leaf-2: #a7c7ff;
      --leaf-3: #7aa6ff;
      --leaf-4: #9ec0ff;
      --leaf-5: #6ea0ff;
    }
    html, body { height: 100%; }
    body{
      margin:0;
      background: transparent;   /* important: see through to index.htmlâ€™s gradient */
      overflow: hidden;          /* keep leaves inside viewport */
    }
    canvas{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      pointer-events: none;      /* never intercept clicks/taps */
    }
  </style>
</head>
<body>
  <canvas id="env"></canvas>
  <script>
  (function(){
    const cvs = document.getElementById('env');
    const ctx = cvs.getContext('2d');
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    let W=0, H=0;

    function resize(){
      W = window.innerWidth; H = window.innerHeight;
      cvs.width  = Math.floor(W * DPR);
      cvs.height = Math.floor(H * DPR);
      cvs.style.width  = W + 'px';
      cvs.style.height = H + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener('resize', resize, {passive:true});
    resize();

    const COLORS = ['var(--leaf-1)','var(--leaf-2)','var(--leaf-3)','var(--leaf-4)','var(--leaf-5)'];
    const LEAF_COUNT = 60;
    const SPEED_MIN = 12, SPEED_MAX = 28;
    const SWAY = 40, ROT_SPEED = 0.5, LINE_WIDTH = 1.6;

    function rand(a,b){ return a + Math.random()*(b-a); }
    function pick(a){ return a[(Math.random()*a.length)|0]; }

    function makeLeaf(){
      const s = rand(0.7, 1.4);
      return {
        x0: rand(-SWAY, W+SWAY),
        y: rand(-H, -40),
        t: rand(0, Math.PI*2),
        sway: rand(SWAY*0.6, SWAY*1.2),
        speed: rand(SPEED_MIN, SPEED_MAX),
        rot: rand(0, Math.PI*2),
        rotSpeed: rand(-ROT_SPEED, ROT_SPEED),
        len: rand(28, 54)*s,
        col: pick(COLORS),
      };
    }
    let leaves = new Array(LEAF_COUNT).fill(0).map(makeLeaf);

    function drawLeaf(l){
      ctx.save();
      ctx.translate(l.x0 + Math.sin(l.t) * l.sway, l.y);
      ctx.rotate(l.rot);

      ctx.lineWidth = LINE_WIDTH;
      ctx.strokeStyle = l.col;
      ctx.globalAlpha = 0.9;

      const len = l.len;
      // midrib
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(0, len * 0.9);
      ctx.stroke();

      // two outline curves
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.bezierCurveTo(-len*0.35, len*0.25, -len*0.25, len*0.65, 0, len*0.9);
      ctx.moveTo(0, 0);
      ctx.bezierCurveTo( len*0.35, len*0.25,  len*0.25, len*0.65, 0, len*0.9);
      ctx.stroke();

      // small veins
      ctx.globalAlpha = 0.6;
      for (let i=0;i<3;i++){
        const p = (i+1)/4;
        ctx.beginPath();
        ctx.moveTo(0, len*p);
        ctx.lineTo(-len*0.18, len*(p-0.06));
        ctx.moveTo(0, len*p);
        ctx.lineTo( len*0.18, len*(p-0.06));
        ctx.stroke();
      }
      ctx.restore();
    }

    let last = performance.now();
    function tick(now){
      const dt = Math.min(0.05, (now - last)/1000);
      last = now;

      ctx.clearRect(0,0,W,H);
      for (let i=0;i<leaves.length;i++){
        const l = leaves[i];
        l.t += dt;
        l.y += l.speed * dt;
        l.rot += l.rotSpeed * dt;

        drawLeaf(l);

        if (l.y > H + 60){
          leaves[i] = makeLeaf();
          leaves[i].y = rand(-H*0.4, -40);
        }
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    document.addEventListener('visibilitychange', () => { last = performance.now(); });
  })();
  </script>
</body>
</html>
