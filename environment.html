<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Environment</title>
<style>
  html, body { height: 100%; margin: 0; background: transparent; }
  canvas { position: fixed; inset: 0; width: 100vw; height: 100vh; display: block; }
</style>
</head>
<body>
<canvas id="env"></canvas>
<script>
(function(){
  const canvas = document.getElementById('env');
  const ctx = canvas.getContext('2d');

  function resize(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const w = canvas.clientWidth, h = canvas.clientHeight;
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  new ResizeObserver(resize).observe(canvas);
  resize();

  // === WIND multiplier (5 = baseline) ===
  let WIND_SLIDER = 5;                  // receives 1..10
  let WIND_FACTOR = WIND_SLIDER / 5;    // 1.0 at baseline
  window.addEventListener('message', (ev) => {
    const d = ev.data || {};
    if (d && d.type === 'WIND_UPDATE') {
      const v = Number(d.wind);
      if (!Number.isNaN(v)) {
        WIND_SLIDER = Math.min(10, Math.max(1, v));
        WIND_FACTOR = WIND_SLIDER / 5;
      }
    }
  });

  // Gentle wind lines + floating leaves (very subtle)
  const STREAMS = 16, LEAVES = 48;
  const LINE = 'rgba(173,190,230,0.08)';
  const LEAF_STROKE = 'rgba(200,220,255,0.28)';
  const LEAF_FILL = 'rgba(200,220,255,0.08)';
  const R = (a,b)=>a+Math.random()*(b-a);
  const wrap01 = v => v < -0.2 ? v+1.4 : (v > 1.2 ? v-1.4 : v);

  const lines = Array.from({length: STREAMS}, () => ({
    x:R(-0.1,1.1), y:R(0,1), len:R(0.25,0.55), amp:R(10,26), phase:R(0,Math.PI*2), th:R(0.7,1.2)
  }));
  const leaves = Array.from({length: LEAVES}, () => ({
    x:R(-0.15,1.15), y:R(-0.05,1.05), s:R(6,12), rot:R(0,Math.PI*2),
    spin:R(-0.002,0.002), driftY:R(-0.03,0.03), phase:R(0,Math.PI*2)
  }));

  let last = performance.now();
  function tick(now){
    const dt = Math.min(60, now - last); last = now;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const W = canvas.clientWidth, H = canvas.clientHeight;

    // wind lines
    ctx.lineCap = 'round'; ctx.strokeStyle = LINE;
    for (const ln of lines){
      ln.x = wrap01(ln.x + dt * 0.00003 * WIND_FACTOR);   // ‚Üê factor applied
      const x0 = ln.x * W, y0 = ln.y * H, pxLen = ln.len * W;
      ctx.lineWidth = ln.th;
      ctx.beginPath();
      const segs = 10;
      for (let i=0;i<=segs;i++){
        const u=i/segs, x=x0+u*pxLen;
        const y=y0 + Math.sin(ln.phase + now*0.002 + u*4)*ln.amp
                    + Math.cos(ln.phase*1.37 + u*2)*(ln.amp*0.25);
        i?ctx.lineTo(x,y):ctx.moveTo(x,y);
      }
      ctx.stroke();
    }

    // leaves
    ctx.lineWidth = 1; ctx.strokeStyle = LEAF_STROKE; ctx.fillStyle = LEAF_FILL;
    for (const leaf of leaves){
      leaf.x = wrap01(leaf.x + (dt*0.000045 * WIND_FACTOR) + Math.sin(now*0.00026 + leaf.phase)*0.00002);
      leaf.y = wrap01(leaf.y + leaf.driftY*(dt*0.00003 * WIND_FACTOR) + Math.cos(now*0.00020 + leaf.phase)*0.000035);
      leaf.rot += leaf.spin * dt * 0.7 * WIND_FACTOR;

      const cx = leaf.x * W, cy = leaf.y * H, s = leaf.s;
      ctx.save(); ctx.translate(cx,cy); ctx.rotate(leaf.rot);
      ctx.beginPath();
      ctx.moveTo(0, -s*0.6);
      ctx.quadraticCurveTo(s*0.55, -s*0.15, 0, s*0.7);
      ctx.quadraticCurveTo(-s*0.55, -s*0.15, 0, -s*0.6);
      ctx.closePath(); ctx.fill(); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,-s*0.45); ctx.quadraticCurveTo(0,s*0.1,0,s*0.55); ctx.stroke();
      ctx.restore();
    }

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
