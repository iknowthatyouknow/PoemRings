<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <style>
    /* Full-bleed, no page scroll */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      overscroll-behavior: none;
      overflow: hidden;              /* no outer scrollbars */
      -webkit-touch-callout: none;
    }

    /* Wrapper that always matches the visual viewport */
    .app {
      position: fixed;
      inset: 0;
      width: 100dvw;
      height: 100dvh;
      background: #000;              /* behind the app */
    }

    /* The app itself: 1:1 fit, no transforms */
    iframe {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
      background: transparent;
      pointer-events: auto;
      overflow: hidden;              /* prevent inner scrollbars */
    }

    /* Optional tiny hint bar (we keep but hidden unless we use it) */
    .hint {
      position: fixed;
      left: 0; right: 0;
      bottom: env(safe-area-inset-bottom, 0);
      text-align: center;
      padding: .4rem .6rem;
      font: 12px system-ui, -apple-system, sans-serif;
      background: rgba(0,0,0,.4);
      color: #ddd;
      opacity: 0;
      transition: opacity .25s ease;
      pointer-events: none;
      user-select: none;
    }
    .hint.show { opacity: 1; }
  </style>
</head>
<body>
  <div class="app">
    <iframe id="appFrame" allow="autoplay; clipboard-read; clipboard-write"></iframe>
  </div>
  <div id="hint" class="hint"></div>

  <script>
    // ---------- detection ----------
    const params = new URLSearchParams(location.search);
    const ua = navigator.userAgent.toLowerCase();
    const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
    const isMobileUA = /iphone|ipad|ipod|android|windows phone|blackberry|silk|kindle|opera mini|mobile/.test(ua);
    const forceMobile  = params.has('mobile');
    const forceDesktop = params.has('desktop');
    const preferMobile = forceMobile || (!forceDesktop && (isMobileUA || (isTouch && innerWidth < 1024)));

    // If NOT mobile: bounce to index.html (keep query string, minus our overrides)
    if (!preferMobile) {
      const kept = [...params.entries()].filter(([k]) => k !== 'mobile' && k !== 'desktop');
      const qs = kept.length ? ('?' + new URLSearchParams(kept).toString()) : '';
      location.replace('index.html' + qs);
    }

    // ---------- elements ----------
    const iframe = document.getElementById('appFrame');
    const hint   = document.getElementById('hint');

    // Forward the current query string to index.html (so app features keep working)
    // IMPORTANT: We DO NOT load environment-loader.js here; index.html should do it.
    iframe.src = 'index.html' + (location.search || '');

    // Refit on visual viewport changes (prevents gaps when iOS toolbars show/hide)
    function refit() {
      // Nothing to compute (weâ€™re 1:1), but we keep this hook
      // if you want to show a "rotate device" hint later.
      // Example (disabled by default):
      // const needsLandscape = iframe.clientWidth < iframe.clientHeight;
      // hint.textContent = needsLandscape ? 'Tip: rotate your device for a better view' : '';
      // hint.classList.toggle('show', !!hint.textContent);
    }

    window.addEventListener('resize', refit, { passive: true });
    window.addEventListener('orientationchange', () => setTimeout(refit, 90), { passive: true });
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', refit, { passive: true });
      window.visualViewport.addEventListener('scroll', refit, { passive: true });
    }

    // Prevent pinch/double-tap zoom in wrapper (keeps gestures on your inner app)
    document.addEventListener('gesturestart', (e) => e.preventDefault(), { passive: false });
    let lastTouch = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, { passive: false });
  </script>
</body>
</html>
