<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <style>
    /* Full-bleed, no page scroll */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      overscroll-behavior: none;
      overflow: hidden;              /* no outer scrollbars */
      -webkit-touch-callout: none;
    }

    /* Wrapper that always matches the visual viewport */
    .app {
      position: fixed;
      inset: 0;
      width: 100dvw;
      height: 100dvh;
      background: #000;              /* behind the app */
    }

    /* The app itself: 1:1 fit, no transforms */
    iframe {
      position: absolute;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
      background: transparent;
      pointer-events: auto;
      overflow: hidden;              /* prevent inner scrollbars */
    }

    .hint { display:none; }
  </style>
</head>
<body>
  <div class="app">
    <iframe id="appFrame" allow="autoplay; clipboard-read; clipboard-write"></iframe>
  </div>

  <script>
    // ---------- detection ----------
    const params = new URLSearchParams(location.search);
    const ua = navigator.userAgent.toLowerCase();
    const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
    const isMobileUA = /iphone|ipad|ipod|android|windows phone|blackberry|silk|kindle|opera mini|mobile/.test(ua);
    const forceMobile  = params.has('mobile');
    const forceDesktop = params.has('desktop');
    const preferMobile = forceMobile || (!forceDesktop && (isMobileUA || (isTouch && innerWidth < 1024)));

    // If NOT mobile: bounce to index.html (keep query string, minus our overrides)
    if (!preferMobile) {
      const kept = [...params.entries()].filter(([k]) => k !== 'mobile' && k !== 'desktop');
      const qs = kept.length ? ('?' + new URLSearchParams(kept).toString()) : '';
      location.replace('index.html' + qs);
    }

    // ---------- load index.html in the iframe ----------
    const iframe = document.getElementById('appFrame');

    // Keep existing params except our overrides, and add two guards:
    //  - desktop=1   -> tells any mobile router inside index.html not to bounce back
    //  - embedded=1  -> our router also skips when it sees this
    const kept = [...params.entries()].filter(([k]) => (k !== 'mobile' && k !== 'desktop'));
    const qp = new URLSearchParams(kept);
    qp.set('desktop', '1');
    qp.set('embedded', '1');

    iframe.src = 'index.html?' + qp.toString();

    // Keep wrapper at exact visual viewport; no scaling needed.
    function refit(){ /* no-op by design */ }
    window.addEventListener('resize', refit, { passive: true });
    window.addEventListener('orientationchange', () => setTimeout(refit, 90), { passive: true });
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', refit, { passive: true });
      window.visualViewport.addEventListener('scroll', refit, { passive: true });
    }

    // Prevent pinch/double-tap zoom in wrapper
    document.addEventListener('gesturestart', (e) => e.preventDefault(), { passive: false });
    let lastTouch = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, { passive: false });
  </script>
</body>
</html>
